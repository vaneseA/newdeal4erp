<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.selSaY.dao.SelSaYDao">

	<!--  목록 조회 -->
	<select id="saleYearList" resultType="kr.happyjob.study.selSaY.model.SelSaYModel">
        SELECT
        pd.product_no,
        lg.pro_lg_name,
        md.pro_md_name,
        sm.pro_sm_name,
        pd.product_serial,
        pd.product_unit_price,
        pd.product_price
        FROM tb_product_lg lg
        INNER JOIN tb_product pd ON lg.pro_lg_cd = pd.pro_lg_cd
        INNER JOIN tb_product_md md ON pd.pro_md_cd = md.pro_md_cd
        INNER JOIN tb_product_sm sm ON pd.pro_sm_cd = sm.pro_sm_cd

        <where>
            <if test="(proLgCd != null) and (!proLgCd.equals(''))">
                and pd.pro_lg_cd = #{proLgCd}
            </if>
            <if test="(proMdCd != null) and (!proMdCd.equals(''))">
                and pd.pro_md_cd = #{proMdCd}
            </if>
            <if test="(pname != null) and (!pname.equals(''))">
                <choose>
                    <when
                            test="searchKey eq 'pro_sm_cd'.toString()">
                        and pd.pro_sm_cd Like CONCAT('%', #{pname}, '%')
                    </when>
                    <otherwise>
                        and (   pd.pro_sm_cd Like CONCAT('%', #{pname}, '%')
                        )
                    </otherwise>
                   </choose>
            </if>
        </where>
        ORDER BY pd.product_no
        LIMIT #{pageindex}, #{pageSize}

    </select>

<select id="countSelSaYList" resultType="int">
SELECT COUNT(*)
FROM tb_product pd

    <where>
        <if test="(proLgCd != null) and (!proLgCd.equals(''))">
            and pd.pro_lg_cd = #{proLgCd}
        </if>
        <if test="(proMdCd != null) and (!proMdCd.equals(''))">
            and pd.pro_md_cd = #{proMdCd}
        </if>
        <if test="(pname != null) and (!pname.equals(''))">
            <choose>
                <when
                        test="searchKey eq 'pro_sm_cd'.toString()">
                    and pd.pro_sm_cd Like CONCAT('%', #{pname}, '%')
                </when>
                <otherwise>
                    and (   pd.pro_sm_cd Like CONCAT('%', #{pname}, '%')
                    )
                </otherwise>
            </choose>
        </if>
    </where>


</select>


</mapper>