<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.busPd.dao.BusPdDao">

	<!--  목록 조회 -->
	<select id="productInfo" resultType="kr.happyjob.study.busPd.model.BusPdModel">
        SELECT pd.product_no
             , pd.product_serial
             , pd.product_name
             , pd.product_unit_price
             , pd.product_price
             , sl.splr_no
             , sl.splr_name
        FROM tb_product pd
        inner join tb_splr sl on sl.splr_no = pd.splr_no
        ORDER BY pd.product_no
        LIMIT #{pageindex}, #{pageSize}

    </select>

<select id="countProductList" resultType="int">
SELECT COUNT(*)
FROM tb_product pd
INNER JOIN tb_detail_code dc ON dc.group_code = 'bk_cd' AND dc.detail_code = sp.bk_cd

</select>


        <!-- 납품기업 한건 조회 -->
<select id="productSelectOne" resultType="kr.happyjob.study.busPd.model.BusPdModel">
    SELECT pd.product_no
         , pd.product_serial
         , pd.product_name
         , pd.product_unit_price
         , pd.product_price
         , sl.splr_no
         , sl.splr_name
    FROM tb_product pd
             inner join tb_splr sl on sl.splr_no = pd.splr_no
    WHERE pd.product_no = #{product_no}
</select>

    <!-- 등록 -->
    <insert id="productInsert">
        <selectKey resultType="int" keyProperty="no" order="BEFORE">
            SELECT ifnull(max(product_no),0) + 1 FROM tb_product
        </selectKey>
        INSERT INTO tb_product
        (
        product_no
        , product_serial
        , product_name
        , product_unit_price
        , product_price
        , splr_no
        , splr_name
        )
        VALUES (
        #{no}
        ,#{product_serial}
        ,#{product_name}
        ,#{product_unit_price}
        ,#{product_price}
        ,#{splr_no}
        ,#{splr_name}
        )
    </insert>

    <!-- 수정 -->
    <update id="productUpdate">
        UPDATE tb_product
        SET product_serial = #{product_serial}
          ,product_name = #{product_name}
          ,product_unit_price = #{product_unit_price}
          ,product_price = #{product_price}
          ,splr_no = #{splr_no}
          ,splr_name = #{splr_name}
        WHERE product_no = #{product_no}
    </update>

    <!-- 납품기업 삭제 -->
    <delete id="productDelete">
        DELETE FROM tb_product
        WHERE product_no = #{product_no}
    </delete>

</mapper>